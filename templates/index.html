<!doctype html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/css/bootstrap.min.css"
          integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">

      <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
            integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
            crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.3/dist/umd/popper.min.js"
            integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49"
            crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/js/bootstrap.min.js"
            integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy"
            crossorigin="anonymous"></script>

    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
            integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
            crossorigin="anonymous"></script>

    <!-- ë‚ ì”¨ API -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://kit.fontawesome.com/133b431d39.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>

    <title>ğŸª‚CONNECTED</title>
    <!--    <link href="style.css" rel="stylesheet" type="text/css"/> CSS íŒŒì¼ ë¶„ë¦¬ ì‹œ ì‚¬ìš© -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Gugi&family=Pacifico&display=swap" rel="stylesheet">

    <script>
        $(document).ready(function () {
            getAllList();
        });

        let list = null
        let regex = /[^0-9]/g

        function getAllList() {
            $('.card-list').empty()
            $.ajax({
                type: "GET",
                url: "/allList",
                data: {},
                success: function (response) {
                    list = response['all_list']
                    for (let i = 0; i < list.length; i++) {
                        let title = list[i]['title']
                        let image = list[i]['image']
                        let price = list[i]['price']
                        let like = list[i]['like']

                        list[i]['price'] = price.replace(regex, "")

                        let temp_html = `<div class="card">
                                            <img class="card-img-top" src="${image}" alt="Card image cap">
                                            <div class="tour-card-body">
                                                <h5 class="tour-title">${title}</h5>
                                                <p class="tour-price">${price}ì›</p>

                                            </div>
                                            <footer class="card-footer">
                                                <span class="icon">
                                                     <i class="fa fa-heart-o"></i>
                                                </span>
                                                <p class="tour-like">${like}</p>
                                                <a href="#" onclick="likeTour('${title}')" class="card-footer-item has-text-info"></a>
                                            </footer>
                                         </div>`
                        $('.card-list').append(temp_html)
                    }
                }
            })
        }

        function sortList(key) {
            $('.card-list').empty()
            let keyValue = key
            let sortedList = null
            if (keyValue == 1) {
                sortedList = list.sort(function (a, b) {
                    return a.price - b.price; // [2, 4, 11, 33] (ì˜¤ë¦„ì°¨ìˆœ)
                })
            }else if(keyValue == 2){
                sortedList = list.sort(function (a, b) {
                    return b.price - a.price // (ë‚´ë¦¼ì°¨ìˆœ)
                })
            }else{
                alert('ì˜¤ë¥˜ì½”ë“œ')
            }

            for (let i = 0; i < sortedList.length; i++) {
                let title = sortedList[i]['title']
                let image = sortedList[i]['image']
                let price = sortedList[i]['price'].toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',')
                let like = sortedList[i]['like']

                let temp_html = `<div class="card">
                                    <img class="card-img-top" src="${image}" alt="Card image cap">
                                    <div class="tour-card-body">
                                        <h5 class="tour-title">${title}</h5>
                                        <p class="tour-price">${price}ì›</p>
                                    </div>
                                    <footer class="card-footer">
                                        <span class="icon">
                                            <i class="fa fa-heart-o"></i>
                                        </span>
                                        <p class="tour-like">${like}</p>
                                        <a href="#" onclick="likeTour('${title}')" class="card-footer-item has-text-info"></a>
                                    </footer>
                                 </div>`
                $('.card-list').append(temp_html)
            }
        }
    </script>

    <!-- ë‚ ì”¨ API -->
    <script type="text/javascript">
        $(document).ready(function () {
            let weatherIcon = {
                '01': 'fa-solid fa-sun',
                '02': 'fas fa-cloud-sun',
                '03': 'fas fa-cloud',
                '04': 'fas fa-cloud-meatball',
                '09': 'fas fa-cloud-sun-rain',
                '10': 'fas fa-cloud-showers-heavy',
                '11': 'fas fa-poo-storm',
                '13': 'far fa-snowflake',
                '50': 'fas fa-smog'
            };

            $.ajax({
                url: 'http://api.openweathermap.org/data/2.5/weather?q=SEOUL&appid=f8a889d8ef48d18452e82cbb13717423&units=metric',
                dataType: 'json',
                type: 'GET',
                success: function (data) {
                    var $Icon = (data.weather[0].icon).substr(0, 2);
                    var $Temp = Math.floor(data.main.temp) + 'Âº';
                    var $city = data.name;
                    $('.CurrIcon1').append('<i class="' + weatherIcon[$Icon] + '"></i>');
                    $('.CurrTemp1').prepend($Temp);
                    $('.City1').append($city);
                }
            })
            $.ajax({
                url: 'http://api.openweathermap.org/data/2.5/weather?q=TOKYO&appid=f8a889d8ef48d18452e82cbb13717423&units=metric',
                dataType: 'json',
                type: 'GET',
                success: function (data) {
                    var $Icon = (data.weather[0].icon).substr(0, 2);
                    var $Temp = Math.floor(data.main.temp) + 'Âº';
                    var $city = data.name;
                    $('.CurrIcon2').append('<i class="' + weatherIcon[$Icon] + '"></i>');
                    $('.CurrTemp2').prepend($Temp);
                    $('.City2').append($city);
                }
            })
        });
    </script>

    <!-- ì¢‹ì•„ìš” êµ¬í˜„ -->
    <script>
        function likeTour(title) {
            $.ajax({
                type: 'POST',
                url: '/api/like',
                data: {title_give:title},
                success: function (response) {
                    alert(response['msg']);
                    window.location.reload()
                }
            });
        }
    </script>
</head>

<body>
<div class="big-wrap">
    <div class="header">

        <div class="title2"></div>
        <h1 class="title2">ğŸª‚ CONNECTED</h1>

        <!-- ë‚ ì”¨ API -->
        <div class="weather">
            <div class="weather_seoul">
                <div class="CurrIcon1"></div>
                <div class="CurrTemp1"></div>
                <div class="City1"></div>
            </div>
            <div class="weather_tokyo">
                <div class="CurrIcon2"></div>
                <div class="CurrTemp2"></div>
                <div class="City2"></div>
            </div>
        </div>
    </div>


    <div id="carouselExampleSlidesOnly" class="main-img" data-ride="carousel">
  <div class="carousel-inner">
    <div class="carousel-item active">
      <img class="d-block w-100" src="https://images.alphacoders.com/674/thumb-1920-674925.png" alt="First slide">
    </div>
    <div class="carousel-item">
      <img class="d-block w-100" src="https://images2.alphacoders.com/592/thumb-1920-592195.jpg" alt="Second slide">
    </div>
    <div class="carousel-item">
      <img class="d-block w-100" src="https://images2.alphacoders.com/546/thumb-1920-546391.jpg" alt="Third slide">
    </div>
  </div>
</div>

<div class="wrap">
    <div class="filter-bar">
        <ul class="filter-left">

            <div class="btn-group">
                <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton1"
                        data-bs-toggle="dropdown" aria-expanded="false">
                    ì—¬í–‰í•  ë„ì‹œ ì„ íƒ
                </button>
                <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton1">
                    <li><a class="dropdown-item" href="#">íŒŒë¦¬</a></li>
                    <li><a class="dropdown-item" href="#">ëŸ°ë˜</a></li>
                    <li><a class="dropdown-item" href="#">ë°©ì½•</a></li>
                    <li><a class="dropdown-item" href="#">ë¡œë§ˆ</a></li>
                    <li><a class="dropdown-item" href="#">í”„ë¼í•˜</a></li>
                    <li><a class="dropdown-item" href="#">ë°”ë¥´ì…€ë¡œë‚˜</a></li>
                    <li><a class="dropdown-item" href="#">ë‰´ìš•</a></li>
                    <li><a class="dropdown-item" href="#">ì„œìš¸</a></li>
                    <li><a class="dropdown-item" href="#">ë¼ìŠ¤ë² ê°€ìŠ¤</a></li>
                    <li><a class="dropdown-item" href="#">ë§ˆë“œë¦¬ë“œ</a></li>
                    <li><a class="dropdown-item" href="#">ë©œë²„ë¥¸</a></li>
                    <li><a class="dropdown-item" href="#">ë¡œìŠ¤ì—”ì ¤ë ˆìŠ¤</a></li>
                    <li><a class="dropdown-item" href="#">í”¼ë Œì²´</a></li>
                    <li><a class="dropdown-item" href="#">ì œì£¼ë„</a></li>
                    <li><a class="dropdown-item" href="#">í•˜ì™€ì´</a></li>
                    <li><a class="dropdown-item" href="#">ë°œë¦¬</a></li>
                    <li><a class="dropdown-item" href="#">ë¹„ì—”ë‚˜</a></li>
                    <li><a class="dropdown-item" href="#">ë¶€ë‹¤í˜ìŠ¤íŠ¸</a></li>
                    <li><a class="dropdown-item" href="#">ë‹¤ë‚­</a></li>
                    <li><a class="dropdown-item" href="#">ë² ì´ì§•</a></li>
                </ul>
            </div>

        </ul>
        <ul class="filter-right">
            <ul class="nav justify-content-end">
                <li class="nav-item">
                    <button class="btn-filter" onclick="getListByLike()">ì¢‹ì•„ìš”ìˆœ</button>
                </li>
                <li class="nav-item">
                    <button class="btn-filter" onclick="sortList(1)">ë‚®ì€ ê°€ê²©ìˆœ</button>
                </li>
                <li class="nav-item">
                    <button class="btn-filter" onclick="sortList(2)">ë†’ì€ ê°€ê²©ìˆœ</button>
                </li>
            </ul>
        </ul>
    </div>
    <div class="card-list">
        <div class="card">
        </div>
    </div>
</div>
</div>


<div class="footer">
    <h2>ğŸª‚CONNECTED</h2>
    <p>Code Travelers</p>
</div>


</body>
</html>


